---
title: "NBR activity"
---

Welcome to my teaching demonstration!

```{r, echo=FALSE, message=FALSE}
library(tidyverse, quiet=T)
library(terra, quiet=T)
library(ggplot2, quiet=T)
library(sf, quiet=T)
# library(shiny)
library(mapview, quiet=T)
library(leaflet, quiet=T)
library(leafsync, quiet=T)
library(RColorBrewer, quiet=T)
library(viridis, quiet=T)

pal =  viridis(100)

```

```{r, echo=FALSE, message=FALSE}
lfiles2<- list.files('C:/Users/hallj/Documents/JobApps/Prof/CUBoulder/interview/Lesson/GEE_Exports', 'tif', full.names = T)

# read in NBR
nbr = rast(lfiles2)



tile<- st_read('C:/Users/hallj/Documents/JobApps/Prof/CUBoulder/interview/Lesson/tile369.shp')%>%
  st_transform(crs=crs(nbr))
# Get bounding box coordinates
bbox <- st_bbox(tile)
xmin <- bbox["xmin"] %>% as.numeric()
xmax <- bbox["xmax"] %>% as.numeric()
ymin <- bbox["ymin"] %>% as.numeric()
ymax <- bbox["ymax"] %>% as.numeric()

# Compute midpoints
xmid <- (xmin + xmax) / 2
ymid <- (ymin + ymax) / 2

# Define four quadrants as bounding boxes
quadrants <- list(
  "NW" = st_as_sfc(st_bbox(c(xmin = xmin, xmax = xmid, ymin = ymid, ymax = ymax), crs = st_crs(tile))),
  "NE" = st_as_sfc(st_bbox(c(xmin = xmid, xmax = xmax, ymin = ymid, ymax = ymax), crs = st_crs(tile))),
  "SW" = st_as_sfc(st_bbox(c(xmin = xmin, xmax = xmid, ymin = ymin, ymax = ymid), crs = st_crs(tile))),
  "SE" = st_as_sfc(st_bbox(c(xmin = xmid, xmax = xmax, ymin = ymin, ymax = ymid), crs = st_crs(tile)))
)

# Choose the quadrant to keep (e.g., "NE")
selected_quadrant <- quadrants[["SE"]]

# # Crop the shapefile to the selected quadrant
# smallertile <- st_intersection(tile, selected_quadrant)
# 
# 
# # crop nbr 
# nbr_cropped = crop(nbr, vect(smallertile))

# resample to a lower resolution
nbr_cropped2<- aggregate(nbr, 6)



leaflet() %>%
  addProviderTiles(providers$Esri.WorldImagery) %>%
  setView(lng = -105.7788 , lat = 40.7484 , zoom = 8) %>%
   addRasterImage(nbr_cropped2[[35]], colors = pal, opacity = 0.8) #%>%
  #addLegend(pal = pal, values = values(nbr_cropped2[[35]]),
  #  title = "Surface temp")
```
